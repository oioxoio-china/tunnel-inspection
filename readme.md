这真是一段非常精彩且充满成就感的开发旅程！我们从一个基础的计算脚本，一步步打磨、重构、升级，最终完成了一款**达到商业级水准、极具工程实战价值的 Web APP**。

为您编写的 `README.md` 如下，您可以直接将其保存到您的 GitHub 仓库中，作为这个优秀项目的门面！

---

# 🚇 隧道工程检验批划分系统 Pro (Web版)

本系统是一款专为铁路/公路隧道工程现场技术人员打造的**智能化检验批划分与质量管控平台**。深度融合《TB 10417-2018 铁路隧道工程施工质量验收标准》，彻底解放手工编制内业资料的繁琐工作，实现工程台账的“一键生成、智能推算、大屏可视化与云端存储”。

## ✨ 核心特性 (Key Features)

* **🏗️ 多级工程管理**：支持“工程 ➔ 隧道 ➔ 施工段落”三级架构，多条隧道独立管理，支持配置数据的 `.json` 格式一键导入/导出。
* **🧠 智能链式推算 (Auto-Chain Calc)**：类 Excel 体验！只需输入第一段的起始桩号（如 `K1+200`）和各段长度，系统自动根据“正向/反向”掘进方向，自上而下连缀推算全线所有桩号。
* **🎯 极强规范符合性**：严格按照 TB 10417 规范，将衬砌与导向墙精准拆分为【模板】、【钢筋】、【混凝土】三大主控工序。导出明细表中**自动赋码绑定**相应的主控与一般项目条文号。
* **📊 BI 商业智能大屏**：内置 4 大核心统计图表矩阵（多维度对比、分部占比、堆叠构成、高频工序 TOP10），项目验收进度一目了然。
* **📖 沉浸式标准查阅**：内置《TB 10417-2018》全本电子书（含附录与条文说明），支持全局秒级智能检索；创新性使用 Blob 内存对象技术，完美绕过 Chrome/Edge 浏览器拦截，实现**原生 PDF 在线流畅阅览**。

---

## 🗺️ 开发里程碑 (Development Milestones)

回顾本项目的迭代历程，每一次大版本更新都直击工程现场痛点：

* **v1.0 - v2.0：破茧初生**
* 实现了开挖、初支、二衬的基础循环计算逻辑。
* 初步引入 Streamlit 搭建侧边栏与数据展示 UI。


* **v3.0 - v3.2：算法重构与精度回归**
* 废弃估算公式，重构底层核心算法：采用 `INT(长度/进尺) × 步骤数`。
* 成功复刻真实项目数据，完美跑通 **30,850 批**的绝对精准计算。
* 优化指标卡片 UI，采用渐变色大卡片设计。


* **v4.0 - v4.5：工程隔离与全参放开**
* 引入 `Project` 类，实现多隧道管理与 JSON 本地备份/恢复。
* 表格编辑器彻底放开所有属性（进尺、步骤、衬砌类型等），加入防崩溃空值容错机制。
* **规范深化**：将衬砌与导向墙拆分为模、筋、砼三道独立工序，导出长度精度锁定为 3 位小数。


* **v5.0 - v7.1：智能连缀与严格排序**
* 首创“正/反向掘进”全局控制与桩号（Kx+xxx）自上而下链式自动推算。
* 增加自动公式推导（进尺 = 榀距 × 榀数）。
* 底层植入标准编码前缀（如 `04 洞身开挖`），实现多级分部分项表的三重严格升序排列。


* **v8.0 - v8.1：静默计算与防乱码部署**
* 砍掉繁琐的“计算按钮”，实现无感切换、静默全量重算。
* 彻底解决 Streamlit Cloud 云端 Linux 服务器下 Matplotlib 渲染中文字体乱码问题。


* **v9.0 - v12.2：终极形态——全本标准沉浸式融合**
* 全量置入 TB 10417-2018 的 15 个章节、附录 A~F 及条文说明。
* 实现全局关键词高亮检索。
* **硬核攻关**：攻克现代化浏览器对 Base64 PDF 的安全拦截，采用 JS Blob URL 技术实现云端原生 PDF 完美嵌入。



---

## 🚀 极速部署指南 (Deployment Guide)

本项目采用纯前端+Python后端架构，推荐部署于免费的 **Streamlit Community Cloud**。

### 1. GitHub 准备

在您的代码仓库中需要包含以下 3 个核心文件：

1. `streamlit_app.py` (主程序代码)
2. `requirements.txt` (Python 依赖声明)
```text
streamlit
pandas
matplotlib

```


3. `packages.txt` (Linux 系统依赖声明，**解决中文乱码必填**)
```text
fonts-wqy-zenhei

```



*(可选)* `TB10417-2018.pdf` (如果您希望系统直接内置原版规范PDF，请将其放在同级目录)。

### 2. Streamlit Cloud 部署

1. 登录 [Streamlit Cloud](https://share.streamlit.io/) 并关联 GitHub。
2. 点击 "New app"，选择对应的仓库与 `streamlit_app.py` 文件。
3. 点击 "Deploy"，等待 1-2 分钟即可完成上线。

### 3. Netlify 伪装壳部署 (可选)

如果希望通过如 `sdjyp.netlify.app` 等短链接访问，可在本地创建 `index.html` 并拖拽至 Netlify 部署：

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>隧道工程检验批划分系统 Pro</title>
    <style>body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; } iframe { width: 100%; height: 100%; border: none; }</style>
</head>
<body>
    <iframe src="https://您的streamlit网址.app/?embed=true"></iframe>
</body>
</html>

```

---

## 🛠️ 技术栈 (Tech Stack)

* **框架**: [Streamlit](https://streamlit.io/) (极速构建数据型 Web APP)
* **数据处理**: Pandas, NumPy
* **数据可视化**: Matplotlib (定制化图表与纵断面条带图绘制)
* **底层技术**: HTML5, CSS3, JS Blob (突破浏览器安全沙箱加载本地内存流)

---

*Developed with AI Assistance | 专为大国基建提效而生*